### Create padding pointings for the overdensity calculation of galaxies at boundaries.
### field # (argv[1])
### Updated: May 9, 2016

import numpy as np
import os, re, sys, glob
from astropy.io import fits
import matplotlib.pyplot as plt

f_man = sys.argv[1]

masklink = "/Volumes/RICKYCHUE/Masks/W{}/".format(f_man)

os.chdir(masklink)

"""
### Getting the coordinates of the padding pointings.
point1 = glob.glob("W{}p3p2*flag.fits.fz".format(f_man))
point2 = glob.glob("W{}p3p3*flag.fits.fz".format(f_man))

hdu1 = fits.open(point1[0])
hdu2 = fits.open(point2[0])

prihdr1 = hdu1[1].header
prihdr2 = hdu2[1].header


print prihdr1['CRVAL1']
print prihdr1['CRVAL2']
print prihdr2['CRVAL1']
print prihdr2['CRVAL2']

#ra = prihdr2['CRVAL1'] + prihdr2['CRVAL1'] - prihdr1['CRVAL1']
ra = prihdr2['CRVAL1'] + prihdr2['CRVAL1'] - prihdr1['CRVAL1']
dec = prihdr2['CRVAL2'] + prihdr2['CRVAL2'] - prihdr1['CRVAL2']

print ", [" + str(ra) + ", " + str(dec) + "]"


### Coordinates of the padding pointings in W1
pt_name = ["W1p5p4", "W1p5p3", "W1p5p2", "W1p5p1", "W1p5m0", "W1p5m1", "W1p5m2", "W1p5m3", "W1p5m4", "W1p5m5", "W1p4m5", "W1p3m5", "W1p2m5", "W1p1m5", "W1m0m5", "W1m1m5", "W1m2m5", "W1m3m5", "W1m4m5", "W1m5m5", "W1m5m4", "W1m5m3", "W1m5m2", "W1m5m1", "W1m5m0", "W1m5p1", "W1m5p2", "W1m5p3", "W1m5p4", "W1m4p4", "W1m3p4", "W1m2p4", "W1m1p4", "W1m0p4", "W1p1p4", "W1p2p4", "W1p3p4", "W1p4p4"]

coord = [[39.28566667, -3.266666667], [39.28566667, -4.2], [39.28566667, -5.133333333], [39.28566667, -6.066666667], [39.28566667, -7.0], [39.28566667, -7.933333333], [39.28566667, -8.866666667], [39.28566667, -9.8], [39.28566667, -10.73333333], [39.28566667, -11.66666667], [38.32854167, -11.66666666], [37.37141667, -11.66666666], [36.41425, -11.66666666], [35.457125, -11.66666666], [34.5, -11.66666666], [33.542875, -11.66666666], [32.58575, -11.66666666], [31.62858333, -11.66666666], [30.67145833, -11.66666666], [29.71433333, -11.66666666], [29.71433333, -10.73333333], [29.71433333, -9.8], [29.71433333, -8.866666667], [29.71433333, -7.933333333], [29.71433333, -7.0], [29.71433333, -6.066666667], [29.71433333, -5.133333333], [29.71433333, -4.2], [29.71433333, -3.266666667], [30.67145833, -3.266666667], [31.62858333, -3.266666667], [32.58575, -3.266666667], [33.542875, -3.266666667], [34.5, -3.266666667], [35.457125, -3.266666667], [36.41425, -3.266666667], [37.37141667, -3.266666667], [38.32854167, -3.266666667]]

### Coordinates of the padding pointings in W2
pt_name = ["W2p4p4", "W2p4p3", "W2p4p2", "W2p4p1", "W2p4m0", "W2p4m1", "W2p4m2", "W2p3m2", "W2p2m2", "W2p1m2", "W2m0m2", "W2m1m2", "W2m2m2", "W2m2m1", "W2m2m0", "W2m2p1", "W2m2p2", "W2m2p3", "W2m2p4", "W2m1p4", "W2m0p4", "W2p1p4", "W2p2p4", "W2p3p4"]

coord = [[137.3105, -0.516666667], [137.3105, -1.45], [137.3105, -2.383333333], [137.3105, -3.316666667], [137.3105, -4.25], [137.3105, -5.183333333], [137.3105, -6.116666667], [136.357875, -6.116666666], [135.40525, -6.116666666], [134.452625, -6.116666666], [133.5, -6.116666666], [132.547375, -6.116666666], [131.59475, -6.116666666], [131.59475, -5.183333333], [131.59475, -4.25], [131.59475, -3.316666667], [131.59475, -2.383333333], [131.59475, -1.45], [131.59475, -0.516666667], [132.547375, -0.516666667], [133.5, -0.516666667], [134.452625, -0.516666667], [135.40525, -0.516666667], [136.357875, -0.516666667]]


### Coordinates of the padding pointings in W3
pt_name = ["W3p4p3", "W3p4p2", "W3p4p1", "W3p4m0",
           "W3p4m1", "W3p4m2", "W3p4m3", "W3m4p3",
           "W3m4p2", "W3m4p1", "W3m4m0", "W3m4m1",
           "W3m4m2", "W3m4m3", "W3m0p4", "W3p1p4",
           "W3p2p4", "W3p3p4", "W3m1p4", "W3m2p4",
           "W3m3p4", "W3m0m4", "W3p1m4", "W3p2m4",
           "W3p3m4", "W3m1m4", "W3m2m4", "W3m3m4",
           "W3p4p4", "W3m4p4", "W3m4m4", "W3p4m4"]

coord = [[221.1515834, 57.30861111], [220.9988751, 56.37527778],
         [220.8547084, 55.44194444], [220.7183751, 54.50861111],
         [220.5894167, 53.57527778], [220.4672083, 52.64194444],
         [220.3512916, 51.70861111], [207.7984166, 57.30861111],
         [207.9511249, 56.37527778], [208.0952916, 55.44194444],
         [208.2316249, 54.50861111], [208.3606249, 53.57527778],
         [208.4828751, 52.64194444], [208.5987916, 51.70861111],
         [214.475, 58.24194444], [216.18225, 58.24194444],
         [217.8895417, 58.24194444], [219.5969167, 58.24194444],
         [212.76775, 58.24194444], [211.0604583, 58.24194444],
         [209.3530833, 58.24194444], [214.475, 50.77527778],
         [215.9150417, 50.77527778], [217.3552083, 50.77527778],
         [218.7952916, 50.77527778], [213.0349583, 50.77527778],
         [211.5947917, 50.77527778], [210.1547499, 50.77527778],
         [221.3042917, 58.24194444], [207.6457083,58.24194444],
         [208.7147081, 50.77527778], [220.2353749, 50.77527778]]
"""
### Coordinates of the padding pointings in W4
pt_name = ["W4p2m3", "W4p1m3", "W4m0m3", "W4m1m3", "W4m2m1", "W4m2m2", "W4m2m3", "W4m3m1", "W4m4p3", "W4m4p2", "W4m4p1", "W4m4m0", "W4m4m1", "W4m1p4", "W4m2p4", "W4m3p4", "W4m4p4", "W4m0p4", "W4m0p3", "W4m0p2", "W4p1p2", "W4p2p2", "W4p2p1", "W4p3p1", "W4p3m0", "W4p3m1", "W4p3m2", "W4p3m3"]

coord = [[335.2241249, -1.4166666667], [334.2740417, -1.4166666667], [333.324, -1.4166666667], [332.3739166, -1.4166666667], [331.4244583, 0.383333334], [331.4239166, -0.5166666667], [331.4233748, -1.4166666667], [330.4747083, 0.383333334], [329.5141667, 4.116666667], [329.5180833, 3.183333333], [329.5210417, 2.25], [329.523, 1.316666667], [329.5239583, 0.383333334], [332.3705417, 5.050000001], [331.4170833, 5.050000001], [330.4636667, 5.050000001], [329.5102083, 5.050000001], [333.3240001, 5.050000001], [333.3240001, 4.116666667], [333.3240001, 3.183333333], [334.27525, 3.183333333], [335.2264999, 3.183333333], [335.2249583, 2.25], [336.1751666, 2.25], [336.17475, 1.316666667], [336.1740417, 0.3833333333], [336.1741249, -0.5166666667], [336.1742081, -1.4166666667]]


print len(pt_name), len(coord)

### Plot to see the coordinates of the padding pointings.
coord = np.array(coord)
"""
#plt.scatter(coord[0][num],coord[1][num])
plt.scatter(coord[0],coord[1])
plt.ylim([-7,0])
plt.xlim([131,138])
plt.gca().invert_xaxis()
plt.show()
plt.close()
"""

print pt_name[0], coord[0]

for i in range(len(pt_name)):
    print "{}, {} out of {} files started!".format(pt_name[i], i + 1, len(pt_name))
    os.system("rm {}_padding.fits".format(pt_name[i]))

    n = np.ones((21000,21000),dtype=np.int16)

    hdu = fits.PrimaryHDU(n)

    hdulist = fits.HDUList([hdu])
    prihdr = hdulist[0].header
    prihdr['CRVAL1'] = coord[i][0]
    prihdr['CDELT1'] = -5.166666789E-05
    prihdr['CRVAL2'] = coord[i][1]
    prihdr['CDELT2'] = 5.166666789E-05
    hdulist.writeto('{}_padding.fits'.format(pt_name[i]))
